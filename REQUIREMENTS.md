# 简单拍卖系统需求文档

## 1. 项目概述

本项目旨在开发一个简单的在线拍卖系统，允许用户发布拍卖标的，所有注册用户都可以参与竞拍。系统提供基本的拍卖功能，包括标的发布、出价竞拍、拍卖管理等核心功能。

## 2. 用户角色

### 2.1 普通用户
- 可以注册和登录系统
- 可以发布拍卖标的
- 可以参与所有公开拍卖的竞拍
- 可以查看自己的拍卖记录和竞拍记录

## 3. 功能需求

### 3.1 用户认证模块

#### 3.1.1 用户注册
- **功能描述**：新用户可以通过邮箱/用户名和密码注册账户
- **输入**：
  - 用户名（必填，唯一）
  - 邮箱（必填，唯一，需验证格式）
  - 密码（必填，至少8位，包含字母和数字）
- **业务规则**：
  - 用户名和邮箱唯一性验证
  - 邮箱格式验证（正则表达式）
  - 密码强度验证（至少8位，包含字母和数字）
  - 密码使用Werkzeug加密存储
- **输出**：注册成功提示，自动登录，返回JWT Token
- **实现状态**：✅ 已实现

#### 3.1.2 用户登录
- **功能描述**：已注册用户可以通过用户名/邮箱和密码登录
- **输入**：
  - 用户名/邮箱（支持两种登录方式）
  - 密码
- **输出**：登录成功，返回用户信息和JWT认证令牌（有效期24小时）
- **实现状态**：✅ 已实现

#### 3.1.3 用户登出
- **功能描述**：用户退出登录，清除会话信息
- **实现说明**：JWT无状态认证，客户端删除Token即可
- **实现状态**：✅ 已实现

#### 3.1.4 获取当前用户信息
- **功能描述**：已登录用户获取自己的账户信息
- **输出**：用户ID、用户名、邮箱
- **实现状态**：✅ 已实现

### 3.2 拍卖标的管理模块

#### 3.2.1 发布拍卖标的
- **功能描述**：登录用户可以发布新的拍卖标的
- **输入**：
  - 标的名称（必填）
  - 标的描述（必填）
  - 起拍价（必填，必须大于0）
  - 拍卖结束时间（必填，必须晚于当前时间）
  - 标的图片（可选，支持多张，JSON数组存储）
  - 最低加价幅度（可选，默认0.01）
- **业务规则**：
  - 只有登录用户可以发布标的
  - 起拍价必须为正数
  - 拍卖结束时间必须至少在未来1小时后
  - 最低加价幅度必须大于0
- **输出**：发布成功，返回标的ID和基本信息
- **实现状态**：✅ 已实现

#### 3.2.2 查看拍卖列表
- **功能描述**：所有用户（包括未登录）可以查看所有拍卖标的列表
- **功能特性**：
  - 支持分页显示（可配置每页数量，默认20条）
  - 显示标的名称、当前最高价、剩余时间、状态（进行中/已结束/流拍）
  - 支持按状态筛选（全部/active/ended/no_bid）
  - 支持按时间排序（最新created_at/最早end_time）
  - 显示竞拍者数量
  - 显示卖家用户名
- **输出**：拍卖标的列表（包含分页信息）
- **实现状态**：✅ 已实现

#### 3.2.3 查看拍卖详情
- **功能描述**：用户可以查看单个拍卖标的的详细信息
- **显示内容**：
  - 标的名称和描述
  - 起拍价
  - 当前最高价
  - 最低加价幅度
  - 当前最高出价者（普通用户隐藏部分信息，卖家可查看完整信息）
  - 拍卖结束时间
  - 剩余时间倒计时（实时计算）
  - 出价历史记录（显示出价金额和时间，普通用户隐藏出价者信息，卖家可查看完整信息）
  - 标的图片（支持多张）
  - 卖家用户名
  - 拍卖状态
- **输出**：拍卖标的详细信息
- **实现状态**：✅ 已实现

#### 3.2.4 查看我的拍卖
- **功能描述**：用户可以查看自己发布的所有拍卖标的
- **显示内容**：
  - 我发布的标的列表
  - 每个标的的当前状态和最高价
  - 每个标的的竞拍者数量
  - 剩余时间
- **实现状态**：✅ 已实现

### 3.3 竞拍模块

#### 3.3.1 参与竞拍（出价）
- **功能描述**：登录用户可以对自己感兴趣的拍卖标的进行出价
- **输入**：
  - 标的ID
  - 出价金额（必填）
- **业务规则**：
  - 只有登录用户可以出价
  - 出价金额必须大于等于当前最高价加上最低加价幅度
  - 出价金额必须大于等于起拍价（如果当前没有出价）
  - 不能对自己的拍卖标的出价
  - 只能在拍卖进行中时出价（未到结束时间）
  - 出价后立即更新当前最高价和最高出价者
  - 记录出价历史
- **输出**：出价成功提示，更新标的当前最高价
- **实现状态**：✅ 已实现

#### 3.3.2 查看我的竞拍记录
- **功能描述**：用户可以查看自己参与的所有竞拍记录
- **显示内容**：
  - 我参与竞拍的标的列表
  - 我的出价记录（包含所有历史出价）
  - 当前是否是最高出价者（进行中的拍卖）
  - 是否中标（已结束的拍卖）
  - 拍卖状态（进行中/已结束/流拍）
  - 剩余时间
- **实现状态**：✅ 已实现

### 3.4 拍卖结算模块

#### 3.4.1 自动结算
- **功能描述**：当拍卖到达结束时间时，系统自动结算
- **业务规则**：
  - 系统定时检查所有进行中的拍卖（每30秒）
  - 到达结束时间的拍卖自动标记为"已结束"或"流拍"
  - 如果有出价，最高出价者成为获胜者，状态标记为"ended"
  - 如果没有出价，拍卖流拍，状态标记为"no_bid"
  - 使用APScheduler后台任务实现
- **输出**：更新拍卖状态，记录获胜者信息
- **实现状态**：✅ 已实现

#### 3.4.2 查看拍卖结果
- **功能描述**：用户可以查看已结束拍卖的结果
- **显示内容**：
  - 获胜者信息（对标的发布者可见完整信息）
  - 最终成交价
  - 拍卖结束时间
  - 拍卖状态（已结束/流拍）
- **实现状态**：✅ 已实现（通过拍卖详情页展示）

## 4. 非功能需求

### 4.1 性能需求
- 拍卖列表加载时间 < 2秒
- 拍卖详情加载时间 < 1秒
- 出价响应时间 < 500ms
- 支持至少100个并发用户

### 4.2 安全需求
- 用户密码必须加密存储
- 所有API接口需要身份验证（除公开查看接口）
- 防止SQL注入和XSS攻击
- 出价操作需要防止重复提交

### 4.3 可用性需求
- 系统可用性 > 95%
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）

### 4.4 数据需求
- 所有拍卖数据需要持久化存储
- 出价记录需要完整保存，不可删除
- 支持数据备份和恢复

## 5. 业务流程

### 5.1 发布拍卖流程
1. 用户登录系统
2. 进入"发布拍卖"页面
3. 填写标的信息（名称、描述、起拍价、结束时间、图片）
4. 提交发布
5. 系统验证信息有效性
6. 创建拍卖标的，状态为"进行中"
7. 返回成功提示

### 5.2 参与竞拍流程
1. 用户浏览拍卖列表或查看拍卖详情
2. 选择感兴趣的拍卖标的
3. 输入出价金额
4. 提交出价
5. 系统验证：
   - 用户已登录
   - 出价金额有效（大于当前最高价）
   - 拍卖仍在进行中
   - 不是自己的拍卖
6. 更新当前最高价和最高出价者
7. 记录出价历史
8. 返回成功提示

### 5.3 拍卖结算流程
1. 系统定时任务检查所有进行中的拍卖
2. 对于到达结束时间的拍卖：
   - 标记状态为"已结束"
   - 如果有出价，确定最高出价者为获胜者
   - 如果没有出价，标记为"流拍"
3. 通知相关用户（可选）

## 6. 数据模型

### 6.1 用户（User）
- id: 用户ID（主键）
- username: 用户名（唯一）
- email: 邮箱（唯一）
- password: 密码（Werkzeug加密）
- created_at: 创建时间
- updated_at: 更新时间

### 6.2 拍卖标的（Auction）
- id: 标的ID（主键）
- title: 标的名称
- description: 标的描述
- starting_price: 起拍价
- current_price: 当前最高价
- min_increment: 最低加价幅度（默认0.01）
- current_bidder_id: 当前最高出价者ID（外键）
- seller_id: 发布者ID（外键）
- end_time: 拍卖结束时间
- status: 状态（active/ended/no_bid）
- images: 标的图片（JSON数组字符串）
- created_at: 创建时间
- updated_at: 更新时间

### 6.3 出价记录（Bid）
- id: 出价ID（主键）
- auction_id: 拍卖标的ID（外键）
- bidder_id: 出价者ID（外键）
- amount: 出价金额
- created_at: 出价时间

## 7. API接口设计（概要）

### 7.1 认证接口
- POST /api/auth/register - 用户注册
- POST /api/auth/login - 用户登录
- POST /api/auth/logout - 用户登出
- GET /api/auth/me - 获取当前用户信息

### 7.2 拍卖标的接口
- POST /api/auctions - 发布拍卖标的（需登录）
- GET /api/auctions - 获取拍卖列表（公开）
- GET /api/auctions/:id - 获取拍卖详情（公开）
- GET /api/auctions/my/listings - 获取我发布的拍卖（需登录）

### 7.3 竞拍接口
- POST /api/auctions/:id/bids - 参与竞拍（需登录）
- GET /api/auctions/my/bids - 获取我的竞拍记录（需登录）

## 8. 界面需求

### 8.1 主要页面
- 首页：显示拍卖列表
- 登录/注册页面
- 拍卖详情页面
- 发布拍卖页面
- 我的拍卖页面
- 我的竞拍记录页面

### 8.2 UI要求
- 界面简洁美观，易于使用
- 响应式设计，支持移动端和桌面端
- 实时显示拍卖剩余时间
- 出价操作有明确的反馈提示

## 9. 后续扩展功能（可选）

- 拍卖提醒功能（邮件/短信通知）
- 拍卖搜索功能
- 拍卖分类功能
- 用户评价系统
- 支付集成
- 拍卖自动延期（最后时刻有新出价时）
- 拍卖收藏功能
- 管理员后台管理

## 10. 技术栈（实际实现）

### 后端技术栈
- **语言**：Python 3.11
- **Web框架**：Flask 3.0.0
- **数据库**：SQLite（支持快速开发和部署）
- **认证**：Flask-JWT-Extended 4.6.0（JWT Token，有效期24小时）
- **密码加密**：Werkzeug 3.0.1
- **跨域处理**：Flask-CORS 4.0.0
- **定时任务**：APScheduler 3.10.4（每30秒检查过期拍卖）
- **环境管理**：python-dotenv 1.0.0

### 前端技术栈
- **框架**：Vue 3.3.4
- **路由**：Vue Router 4.2.5
- **UI组件库**：Element Plus 2.4.4
- **HTTP客户端**：Axios 1.6.0
- **图标库**：@element-plus/icons-vue 2.3.1
- **构建工具**：Vue CLI 5.0.8

### 部署技术栈
- **容器化**：Docker（多阶段构建）
- **Web服务器**：Nginx（反向代理和静态文件服务）
- **进程管理**：Supervisor（管理Flask和Nginx进程）
- **镜像加速**：使用阿里云和npm国内镜像源

### 架构特点
- **前后端分离**：前端Vue单页应用，后端Flask RESTful API
- **容器化部署**：一键启动，包含前后端和数据库
- **数据持久化**：Docker数据卷挂载
- **日志管理**：完整的请求和错误日志
- **安全性**：密码加密、JWT认证、CORS配置
- **可扩展性**：模块化设计，易于扩展新功能

### 数据库设计
- **类型**：SQLite（文件数据库）
- **位置**：开发模式 `backend/auction.db`，Docker模式 `data/database/auction.db`
- **特点**：零配置、易于部署、支持完整SQL功能
- **索引**：针对常用查询字段建立索引（status、end_time、auction_id、bidder_id）

## 11. 实现总结

### 核心功能实现进度
所有需求功能均已完成实现：

- ✅ 用户认证模块（注册、登录、登出、获取用户信息）
- ✅ 拍卖管理模块（发布、列表、详情、我的拍卖）
- ✅ 竞拍模块（出价、我的竞拍记录）
- ✅ 拍卖结算模块（自动结算、结果查看）

### 额外实现功能
除了基本需求外，还实现了以下增强功能：

1. **最低加价幅度**：发布拍卖时可自定义最低加价幅度，提高竞价灵活性
2. **中标判断**：准确判断用户是否中标（已结束拍卖）
3. **IP追踪**：支持反向代理环境下的客户端IP追踪
4. **完善的日志**：详细的请求和响应日志，便于调试和监控
5. **Docker部署**：完整的容器化部署方案，一键启动
6. **数据持久化**：Docker环境下数据永久保存
7. **隐私保护**：出价者信息对普通用户部分隐藏，对卖家完全可见

### 项目文件结构
```
SimpleAuction/
├── backend/              # 后端代码
│   ├── app.py           # Flask应用入口
│   ├── auth.py          # 认证API
│   ├── auction.py       # 拍卖API
│   ├── bid.py           # 竞拍API
│   ├── models.py        # 数据模型
│   ├── database.py      # 数据库初始化
│   ├── scheduler.py     # 定时任务
│   ├── config.py        # 配置文件
│   └── requirements.txt # Python依赖
├── frontend/            # 前端代码
│   ├── src/
│   │   ├── views/       # 页面组件
│   │   ├── router/      # 路由配置
│   │   ├── store/       # 状态管理
│   │   └── api/         # API接口
│   └── package.json     # 前端依赖
├── data/                # 数据目录（Docker持久化）
│   ├── database/        # 数据库文件
│   ├── uploads/         # 上传文件
│   └── logs/            # 日志文件
├── Dockerfile           # Docker镜像配置
├── start-docker.sh      # Docker启动脚本
├── stop-docker.sh       # Docker停止脚本
├── restart-docker.sh    # Docker重启脚本
├── README.md            # 项目说明文档
└── REQUIREMENTS.md      # 需求文档（本文件）
```

### 部署方式
1. **Docker部署**（推荐）：`./start-docker.sh`，访问 http://localhost:18080
2. **手动启动**（开发）：分别启动后端（port 3000）和前端（port 8080）

### 文档说明
- **README.md**：项目安装、运行、API文档
- **REQUIREMENTS.md**：需求规格、功能说明、技术栈

项目已完成所有核心功能开发，可以正常运行并投入使用。

